webpackJsonp([0],[function(a,b,c){"use strict";function d(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function e(a=500){return function(b,c,d){const e=d.value;let f=0;return d.value=function(...b){event&&event.preventDefault(),clearTimeout(f),f=setTimeout(()=>{e.apply(this,b)},a)},d}}function f(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function g(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}Object.defineProperty(b,"__esModule",{value:!0});let h=class{constructor(a,b,c){Object.assign(this,{_data:new Date(a.getTime()),_quantidade:b,_valor:c}),Object.freeze(this)}get data(){return new Date(this._data.getTime())}get quantidade(){return this._quantidade}get valor(){return this._valor}get volume(){return this._quantidade*this._valor}},i=class{constructor(a){this._connection=a,this._store="negociacoes"}adiciona(a){return new Promise((b,c)=>{const d=this._connection.transaction([this._store],"readwrite").objectStore(this._store).add(a);d.onsuccess=()=>b(),d.onerror=()=>c("N\xE3o foi poss\xEDvel salvar a negocia\xE7\xE3o")})}listaTodos(){return new Promise((a,b)=>{const c=[],d=this._connection.transaction([this._store],"readwrite").objectStore(this._store).openCursor();d.onsuccess=(b)=>{const d=b.target.result;if(d){const a=new h(d.value._data,d.value._quantidade,d.value._valor);c.push(a),d.continue()}else a(c)},d.onerror=(a)=>{console.log(a.target.error),b("N\xE3o foi poss\xEDvel listar nas negocia\xE7\xF5es")}})}apagaTodos(){return new Promise((a,b)=>{const c=this._connection.transaction([this._store],"readwrite").objectStore(this._store).clear();c.onsuccess=()=>a(),c.onerror=(a)=>{console.log(a.target.error),b("N\xE3o foi poss\xEDvel apagar as negocia\xE7\xF5es")}})}},j=class{_handleErrors(a){if(!a.ok)throw new Error(a.statusText);return a}get(a){return fetch(a).then((a)=>this._handleErrors(a)).then((a)=>a.json())}},k=class{constructor(){this.http=new j}obterNegociacoesDaSemana(){return new j().get("http://localhost:3000/negociacoes/semana").then((a)=>a.map((a)=>new h(new Date(a.data),a.quantidade,a.valor))).catch(()=>{throw new Error("N\xE3o foi poss\xEDvel obter as negocia\xE7\xF5es")})}obterNegociacoesDaSemanaAnterior(){return new j().get("http://localhost:3000/negociacoes/anterior").then((a)=>a.map((a)=>new h(new Date(a.data),a.quantidade,a.valor))).catch(()=>{throw new Error("N\xE3o foi poss\xEDvel obter as negocia\xE7\xF5es da semana anterior")})}obterNegociacoesDaSemanaRetrasada(){return new j().get("http://localhost:3000/negociacoes/retrasada").then((a)=>a.map((a)=>new h(new Date(a.data),a.quantidade,a.valor))).catch(()=>{throw new Error("N\xE3o foi poss\xEDvel obter as negocia\xE7\xF5es da semana retrasada")})}obterNegociacoesDoPerildo(){var a=this;return d(function*(){try{const b=yield Promise.all([a.obterNegociacoesDaSemana(),a.obterNegociacoesDaSemanaAnterior(),a.obterNegociacoesDaSemanaRetrasada()]);return b.reduce(function(b,c){return[...b,...c]},[]).sort(function(c,a){return c.data.getTime()-a.data.getTime()})}catch(a){throw console.log(err),new Error("N\xE3o foi poss\xEDvel obter as negocia\xE7\xF5es do per\xEDodo")}})()}},l=class{constructor(){this._negociacoes=[]}get volumeTotal(){return this._negociacoes.reduce((a,b)=>a+b.volume,0)}adiciona(a){this._negociacoes=[...this._negociacoes,a]}esvazia(){this._negociacoes.length=0}paraArray(){return this._negociacoes.map((a)=>a)}},m=class{constructor(){throw new Error("Esta classe n\xE3o pode ser instanciada")}static paraTexto(a){return a.toLocaleDateString()}static paraData(a){if(console.log("texto",a),!/^\d{4}-\d{2}-\d{2}/.test(a))throw new Error("A data nao egue o padr\xE3o correto");return new Date(...a.split("-").map((a,b)=>a-b%2))}},n=class{constructor(a=""){this._texto=a}get texto(){return this._texto}set texto(a){this._texto=a}},o=class{constructor(a){this._elemento=document.querySelector(a)}update(a){this._elemento.innerHTML=this.template(a)}template(){throw new Error("Voc\xEA precisa implementar o m\xE9todo template")}},p=class extends o{template(a){return a.texto?`<p class="alert alert-info">${a.texto}</p>`:`<p></p>`}},q=class extends o{template(a){return`
            <table class="table table-hover table-bordered">
                <thead>
                    <tr>
                        <th>DATA</th>
                        <th>QUANTIDADE</th>
                        <th>VALOR</th>
                        <th>VOLUME</th>
                    </tr>
                </thead>
                <tbody>
                    ${a.paraArray().map((a)=>{return`
                            <tr>
                                <td>${m.paraTexto(a.data)}</td>
                                <td>${a.quantidade}</td>
                                <td>${a.valor}</td>
                                <td>${a.volume}</td>
                            </tr>
                    `}).join("")}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3"></td>
                        <td>${a.volumeTotal}</td>
                        </tr>
                </tfoot>
            </table>
        `}},r=class{static create(a,b,c){return new Proxy(a,{get(a,d){return typeof a[d]==typeof Function&&b.includes(d)?function(){a[d].apply(a,arguments),c(a)}:a[d]},set(a,d,e){const f=Reflect.set(a,d,e);return b.includes(d)&&c(a),f}})}},s=class{constructor(a,b,...c){const d=r.create(a,c,(a)=>b.update(a));return b.update(a),d}};const t=(()=>{const a=["negociacoes"];let b=null,c=null;return class d{constructor(){throw new Error("Static Class, n\xE3o \xE9 poss\xEDvel criar uma inst\xE2ncia da mesma")}static getConnection(){return new Promise((a,f)=>{if(b)return a(b);const e=indexedDB.open("jscangaceiro",2);e.onupgradeneeded=(a)=>{d._createStores(a.target.result)},e.onsuccess=(d)=>{b=d.target.result,c=b.close.bind(b),b.close=()=>{throw new Error("Voc\xEA n\xE3o pode fechar diretamente a conex\xE3o")},a(b)},e.onerror=(a)=>f(a.target.error.name)})}static closeConnection(){b&&c()}static _createStores(b){a.forEach((a)=>{b.objectStoreNames.contains(a)&&b.deleteObjectStore(a),b.createObjectStore(a,{autoIncrement:!0})})}}})(),u=()=>t.getConnection().then((a)=>new i(a));var v,w,x,y,z;let A=(v=function(...a){const b=a.map((a)=>document.querySelector(a));return function(a){const c=a,d=function(){return new c(...b)};return d.prototype=c.prototype,d}}("#data","#quantidade","#valor"),w=e(),x=e(1500),v(y=(z=class{constructor(a,b,c){document.querySelector.bind(document);this._inputData=a,this._inputQuantidade=b,this._inputValor=c,this._negociacoes=new s(new l(),new q("#negociacoes"),"adiciona","esvazia"),this._mensagem=new s(new n(),new p("#mensagemView"),"texto"),this._service=new k,this._init()}_init(){var a=this;return f(function*(){try{const b=yield u(),c=yield b.listaTodos();c.forEach(function(b){return a._negociacoes.adiciona(b)})}catch(b){a._mensagem.texto=b}})()}adiciona(a){var b=this;return f(function*(){try{a.preventDefault();const c=b.criarNegociacao(b._inputData,b._inputQuantidade,b._inputValor),d=yield u();yield d.adiciona(c),b._negociacoes.adiciona(c),b._mensagem.texto="Negocia\xE7\xE3o adiconada com Sucesso!!!",b.limpaFormulario()}catch(a){console.log("err",a),b._mensagem.texto=a}})()}esvazia(){this._negociacoes.esvazia()}criarNegociacao(a,b,c){return new h(new Date(m.paraData(a.value)),parseInt(b.value),parseFloat(c.value))}importaNegociacoes(){var a=this;return f(function*(){try{const b=yield a._service.obterNegociacoesDoPerildo();b.forEach(function(b){return a._negociacoes.adiciona(b)}),a._mensagem.texto="Negocia\xE7\xF5es importadas com sucesso"}catch(b){a._mensagem.texto=b}})()}apaga(){var a=this;return f(function*(){try{const b=yield u();yield b.apagaTodos(),a._negociacoes.esvazia(),a._mensagem.texto="Negocia\xE7\xF5es apagadas com sucesso"}catch(b){a._mensagem.texto=b}})()}limpaFormulario(){this._inputData.value="",this._inputQuantidade.value=1,this._inputValor.value=0}},g(z.prototype,"adiciona",[w],Object.getOwnPropertyDescriptor(z.prototype,"adiciona"),z.prototype),g(z.prototype,"importaNegociacoes",[x],Object.getOwnPropertyDescriptor(z.prototype,"importaNegociacoes"),z.prototype),z))||y);var B=c(1),C=c.n(B),D=c(2),E=c.n(D),F=c(3),G=c.n(F);const H=document.querySelector.bind(document);let I=new A;H(".form").addEventListener("submit",I.adiciona.bind(I)),H("#botao-apaga").addEventListener("click",I.apaga.bind(I)),H("#botao-importa").addEventListener("click",I.importaNegociacoes.bind(I))},function(){},function(){},function(){}],[0]);